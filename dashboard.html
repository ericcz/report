<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>DashBoard</title>
<link rel="stylesheet" href="include/css/bootstrap.css">
<link rel="stylesheet" href="include/css/bootstrap-datetimepicker.css">
<style>
body {padding:20px;background-color:#eee;}
.dv-img {margin-right:-30px;margin-top:25%;float:right;width:25px;height:70px;background:url('include/img/icon.jpg') no-repeat -138px -145px;cursor:pointer;}
.alert-st {padding:5px;text-align:center;font:18px/1.5em 'Microsoft YaHei';}
.font1 {font:24px/1.5em 'Microsoft YaHei';}
.font2 {font:50px/1.5em 'Microsoft YaHei';}
section {cursor:pointer}
ul,li {list-style:none}
</style>
<script src="include/js/jquery-3.0.0.min.js"></script>
<script src="include/js/bootstrap.min.js"></script>
<script src="include/js/bootstrap-datetimepicker.js"></script>
<script src="include/js/highcharts.js"></script>
<script src="include/js/jquery.bootstrap.newsbox.min.js"></script>
<script type="text/javascript">
function createXMLHttpRequest(url,dv){
	xmlhttp=""
	if(window.ActiveXObject){
		try{
		xmlhttp = new ActiveXObject("Msxml2.XMLHTTP");
		}catch(e){
		xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
		}}
		else if(window.XMLHttpRequest){
			xmlhttp = new XMLHttpRequest();
				if (xmlhttp.overrideMimeType){ xmlhttp.overrideMimeType("text/xml");}
		}
		if(!xmlhttp){ window.alert("Do not support XMLHttpRequest!");}
		xmlhttp.onreadystatechange=XHRChanged;
		xmlhttp.open("POST", url,false);
		xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");
		xmlhttp.send(dv);
}
function XHRChanged(){	//handle return value xmlhttp.responseText
	if (xmlhttp.readyState==4){
		getBack(xmlhttp.responseText);}
}

function showChart_columnStacked(cData,cTitle,content,xRay){
	var chart;
	var options = {
			chart: {
				renderTo: content,
				defaultSeriesType: 'column'
			},
			title: {
				text: cTitle
			},
			xAxis: {
				categories: xRay
			},
			yAxis: {
				min: 0,
				title: {
					text: ''
				}
			},
			legend: {
				align: 'right',
				x: -100,
				verticalAlign: 'top',
				y: 20,
				floating: true,
				backgroundColor: '#FFFFFF',
				borderColor: '#CCC',
				borderWidth: 1,
				shadow: false
			},
			tooltip: {
				formatter: function() {
					return '<b>'+ this.x +'</b> '+ this.series.name +': '+ this.y +' Total: '+ this.point.stackTotal;
				}
			},
			plotOptions: {
				column: {
					stacking: 'normal'
				}
			},
			series: []
		};
		var v,arr=new Array(),a=new Array();
		for (var i=0;i<cData.split(';').length;i++){
			arr=cData.split(';')[i].split(',');
			v=arr[0];
			arr.shift();
			for(var j=0;j<arr.length;j++){
				a[j]=parseInt(arr[j]);
			}
			options.series.push({name:v,data:a});
			a=[]
		}
		chart = new Highcharts.Chart(options);
}
function showChart_lineBasic(cData,cTitle,content,xRay){
	var chart;
	var options = {
			chart: {
				renderTo: content,
				defaultSeriesType: 'line',
				marginRight: 110,
				marginBottom: 25
			},
			title: {
				text: cTitle,
				x: -20 
			},
			subtitle: {
				text: '',
				x: -20
			},
			xAxis: {
				categories: xRay
			},
			yAxis: {
				title: {
					text: ''
				},
			plotLines: [{
				value: 0,
				width: 1,
				color: '#808080'
			}]
			},
			tooltip: {
				formatter: function() {
						return '<b>'+ this.series.name +'</b>'+
						this.x +': '+ this.y +'';
				}},
			legend: {
				layout: 'vertical',
				align: 'right',
				verticalAlign: 'top',
				x: -10,
				y: 100,
				borderWidth: 0
			},
			series:[]
		};
		var v,arr=new Array(),a=new Array();
		for (var i=0;i<cData.split(';').length;i++){
			arr=cData.split(';')[i].split(',');
			v=arr[0];
			arr.shift();
			for(var j=0;j<arr.length;j++){
				a[j]=parseInt(arr[j]);
			}
			options.series.push({name:v,data:a});
			a=[]
		}
		chart = new Highcharts.Chart(options);
}

function showChart_pieBasic(cData,cTitle,content){
	var chart;
	var options = {
		chart:{renderTo: content,
				plotBackgroundColor: null,
				plotBorderWidth: null,
				plotShadow: false
				},
		title:{text: null},	// title
		subtitle:{text:''},
		tooltip:{formatter:function(){
					return '<b>'+ this.point.name +'</b>: '+ this.y +' %';
				}},
		plotOptions:{pie:{allowPointSelect:true,
							cursor:'pointer',
							dataLabels:{
							enabled:true,
							color:'#000000',
							connectorColor:'#000000',
							formatter:function(){
								return '<b>'+ this.point.name +'</b>: '+ this.y +' %';
							}}
						}
					},
		series:[{type: 'pie',
				name: 'Browser share',
				data:[]
				}]
		};
		var v,arr=new Array(),a=new Array(),b=new Array();
		a=cData.split(';')
		for (var j=0;j<a.length;j++){
			b[0]=a[j].split(',')[0];
			b[1]=parseFloat(a[j].split(',')[1]);
			arr[j]=b;
			b=[]
		}
		options.series[0].data = arr;
		chart = new Highcharts.Chart(options);
}

function getBack(vchReturn){
try{
	var vf=vchReturn.split("##")[1]
	if (vf=='getDashBoard'){
	var rt,dsc
	rt=vchReturn.split("##")[2].split("$$")[2].split(",");
	if (parseInt(rt[rt.length-1])>parseInt(rt[rt.length-2])){
		dsc='<span class="glyphicon glyphicon-chevron-up" aria-hidden="true" style="color:#6f0"></span>';
	}else
		dsc='<span class="glyphicon glyphicon-chevron-down" aria-hidden="true" style="color:#f60"></span>';
	$(".sect-download .alert").html("昨日下载数");

	$(".dv-download").html(rt[rt.length-1])
	$(".dv-download2").html(dsc+"&nbsp;"+Math.round((rt[rt.length-1]-rt[rt.length-2])/rt[rt.length-1]*10000)/100+"%")

	rt=vchReturn.split("##")[3].split("$$")[2].split(",");
	if (parseInt(rt[rt.length-2])>parseInt(rt[rt.length-3])){
		dsc='<span class="glyphicon glyphicon-chevron-up" aria-hidden="true" style="color:#6f0"></span>';
	}else
		dsc='<span class="glyphicon glyphicon-chevron-down" aria-hidden="true" style="color:#f60"></span>';
	$(".sect-register .alert").html("注册人数");
	$(".dv-register").html(rt[rt.length-2]);
	$(".dv-register2").html("今日注册数："+rt[rt.length-1]+"&nbsp;&nbsp;&nbsp;&nbsp;"+dsc+"&nbsp;"+Math.round((rt[rt.length-2]-rt[rt.length-3])/rt[rt.length-2]*10000)/100+"%");
	
	rt=vchReturn.split("##")[4].split("$$")[2].split(",");
	if (parseInt(rt[rt.length-1])>parseInt(rt[rt.length-2])){
		dsc='<span class="glyphicon glyphicon-chevron-up" aria-hidden="true" style="color:#6f0"></span>';
	}else
		dsc='<span class="glyphicon glyphicon-chevron-down" aria-hidden="true" style="color:#f60"></span>';
	$(".sect-active .alert").html("昨日活跃用户数");
	$(".dv-active").html(rt[rt.length-1]);
	$(".dv-active2").html(dsc+"&nbsp;"+Math.round((rt[rt.length-1]-rt[rt.length-2])/rt[rt.length-1]*10000)/100+"%");

	rt=vchReturn.split("##")[5].split("$$");
	$(".dv-keep-d").html('<p class=font2>'+rt[1]+'%</p>');
	rt=vchReturn.split("##")[6].split("$$");
	$(".dv-keep-w").html('<p class=font2>'+rt[1]+'%');
	rt=vchReturn.split("##")[7].split("$$");
	$(".dv-keep-m").html('<p class=font2>'+rt[1]+'%');

	rt=vchReturn.split("##")[8].split("$$");
	$(".dv-pv").html(rt[1]);
	rt=vchReturn.split("##")[9].split("$$");
	$(".dv-uv").html(rt[1]);
	rt=vchReturn.split("##")[10].split("$$");
	$(".ul-loc").html(rt[1]);
	
		$(".ul-loc").bootstrapNews({
		newsPerPage: 1,
		autoplay: true,
		pauseOnHover:true,
		direction: 'down',
		newsTickerInterval: 4000,
		navigation: false,
		onToDo: function () {
			//console.log(this);
		}
	});
	
	
	}else if(vf=='getDetail'||vf=='getDetailPv'||vf=='getDetailLeft'){
		$(".tab").html(vchReturn.split("##")[2]);
		if (vf=='getDetailPv'){
		var chartDt= new Array
		chartDt=vchReturn.split("##")[3].split(",");
		var chartData=vchReturn.split("##")[4];
		showChart_lineBasic(chartData.substring(0,chartData.length-1),"","chart",chartDt);
		$("#chart").show()
		}
		if (vf=='getDetail'){
		var pr=0;
		var amount="";
		for (i=0;i<7;i++){
			pr=0
			$(".col"+i).each(function(){
				pr+=parseInt($(this).html());
			});
			amount+="<td>"+pr+"</td>"
		}
		amount="<tr><td style='width:10%'>合计</td>"+amount+"</table>"
		$(".tab").html($(".tab").html().replace('</table>',amount));
		}
		$(".dv-ext").show();
		$(".dv-ext-in").show()
		
	}else{}
		}catch(e){ alert(e);}
}
$(document).ready(function(){
	var user=document.cookie;
	user="cz"
	if (user==""){
		alert("Pls Login");
		window.location="index.html";
	}
	setTimeout(function(){
	url="dashboardGet.php?pid="+escape(document.cookie.split('#')[0])+"&obj="+escape("getDashBoard");
	createXMLHttpRequest(url,"fresh=" +Math.random());
	},300);
	$(".dv-img").click(function(){
		//location.href="queryRp.html";
	})
	setInterval(function(){
		if ($(".dv-ext").css("display")=="none"){
			url="dashboardGet.php?pid="+escape(document.cookie.split('#')[0])+"&obj="+escape("getDashBoard");
			createXMLHttpRequest(url,"fresh=" +Math.random());
		}
	},10000);

	var dt = new Date();
	var m="0"+(dt.getMonth()+1);
	var d="0"+(dt.getDate()-1);
	vdt=dt.getFullYear()+"-"+m.substr(m.length-2,2)+"-"+d.substr(d.length-2,2);
	
	$('.sect-download').mouseover(function(){
		$(this).css('border','1px solid #000')
	}).mouseout(function(){
		$(this).css('border','0px solid #fff')
	}).click(function(){
		setTimeout(function(){
		url="dashboardGet.php?pid="+escape(document.cookie.split('#')[0])+"&obj="+escape("getDetail")+"&dt="+escape(vdt)+"&typ="+escape("down");
		createXMLHttpRequest(url,"fresh=" +Math.random());
		},300);
	})
	
	$('.sect-register').mouseover(function(){
		$(this).css('border','1px solid #000')
	}).mouseout(function(){
		$(this).css('border','0px solid #fff')
	}).click(function(){
		setTimeout(function(){
		url="dashboardGet.php?pid="+escape(document.cookie.split('#')[0])+"&obj="+escape("getDetail")+"&dt="+escape(vdt)+"&typ="+escape("reg");
		createXMLHttpRequest(url,"fresh=" +Math.random());
		},300);
	})
	$('.sect-active').mouseover(function(){
		$(this).css('border','1px solid #000')
	}).mouseout(function(){
		$(this).css('border','0px solid #fff')
	}).click(function(){
		setTimeout(function(){
		url="dashboardGet.php?pid="+escape(document.cookie.split('#')[0])+"&obj="+escape("getDetail")+"&dt="+escape(vdt)+"&typ="+escape("lively");
		createXMLHttpRequest(url,"fresh=" +Math.random());
		},300);
	})
	$('.sect-pv').mouseover(function(){
		$(this).css('border','1px solid #000')
	}).mouseout(function(){
		$(this).css('border','0px solid #fff')
	}).click(function(){
		setTimeout(function(){
		url="dashboardGet.php?pid="+escape(document.cookie.split('#')[0])+"&obj="+escape("getDetailPv")+"&dt="+escape(vdt)+"&typ="+escape("pv");
		createXMLHttpRequest(url,"fresh=" +Math.random());
		},300);
	})
	$('.sect-uv').mouseover(function(){
		$(this).css('border','1px solid #000')
	}).mouseout(function(){
		$(this).css('border','0px solid #fff')
	}).click(function(){
		setTimeout(function(){
		url="dashboardGet.php?pid="+escape(document.cookie.split('#')[0])+"&obj="+escape("getDetailPv")+"&dt="+escape(vdt)+"&typ="+escape("uv");
		createXMLHttpRequest(url,"fresh=" +Math.random());
		},300);
	})
	$('.sect-locate').mouseover(function(){
		$(this).css('border','1px solid #000')
	}).mouseout(function(){
		$(this).css('border','0px solid #fff')
	}).click(function(){
		setTimeout(function(){
		url="dashboardGet.php?pid="+escape(document.cookie.split('#')[0])+"&obj="+escape("getDetail")+"&dt="+escape(vdt)+"&typ="+escape("loc");
		createXMLHttpRequest(url,"fresh=" +Math.random());
		},300);
		$(".tab").css("overflow","scroll").css("overflow-x","hidden").css("height","500px")

	})
	$('.dv-keep-d').click(function(){
		setTimeout(function(){
		url="dashboardGet.php?pid="+escape(document.cookie.split('#')[0])+"&obj="+escape("getDetailLeft")+"&dt="+escape(vdt)+"&typ="+escape("leftD");
		createXMLHttpRequest(url,"fresh=" +Math.random());
		},300);
	})
	$('.dv-keep-w').click(function(){
		setTimeout(function(){
		url="dashboardGet.php?pid="+escape(document.cookie.split('#')[0])+"&obj="+escape("getDetailLeft")+"&dt="+escape(vdt)+"&typ="+escape("leftW");
		createXMLHttpRequest(url,"fresh=" +Math.random());
		},300);
	})	
	$('.dv-keep-m').click(function(){
		setTimeout(function(){
		url="dashboardGet.php?pid="+escape(document.cookie.split('#')[0])+"&obj="+escape("getDetailLeft")+"&dt="+escape(vdt)+"&typ="+escape("leftM");
		createXMLHttpRequest(url,"fresh=" +Math.random());
		},300);
	})
	
	
	$('.tab-close').click(function(){
		$(".dv-ext").hide();
		$(".dv-ext-in").hide();
		$("#chart").hide();
		$(".tab").css("overflow","auto").css("height","")
	})

	
	chdv="Firefox,45.0;IE,26.8;Opera,6.2;Others,0.7;Chrome,12.8##Source"
	var arr =new Array
	arr=chdv.split("##");
	cData=arr[0];
	cTitle="";
	content="customer-pie";
	showChart_pieBasic(cData,cTitle,content);

})

</script>
</head>
<body><!--div class="dv-img"></div-->
<div id="container" >
<section class="sect-download" style="margin-left:5%;float:left;width:30%;height:240px;padding:20px;border:1px solid #fff; color:#000; border-radius:6px;background:white;box-shadow:0 0 8px #222; font:11px/1.5em 'Microsoft YaHei';">
<div id="filelist" class='alert alert-info alert-st' >&nbsp;</div>
<div class="dv-download" style="padding:5px;text-align:center;font:70px/1.5em 'Microsoft YaHei';color:#aaa"></div>
<div class="dv-download2" style="padding:5px;margin-top:-10px;text-align:right;font:30px/1.5em 'Microsoft YaHei';color:#aaa"></div>
</section>

<section class="sect-register" style="float:left;margin-left:6px;width:30%;height:240px;padding:20px;border:1px solid #fff; color:#000; border-radius:6px;background:white;box-shadow:0 0 8px #222; font:11px/1.5em 'Microsoft YaHei';">
<div id="filelist" class='alert alert-info alert-st' >&nbsp;</div>
<div class="dv-register" style="padding:0px;text-align:center;font:70px/1.5em 'Microsoft YaHei';color:#aaa"></div>
<div class="dv-register2" style="padding:0px;text-align:right;font:20px/1.5em 'Microsoft YaHei';color:#aaa"></div>
</section>
<section class="sect-active" style="float:left;margin-left:6px;width:30%;height:240px;padding:20px;border:1px solid #fff; color:#000; border-radius:6px;background:white;box-shadow:0 0 8px #222; font:11px/1.5em 'Microsoft YaHei';">
<div id="filelist" class='alert alert-info alert-st' >&nbsp;</div>
<div class="dv-active" style="padding:0px;text-align:center;font:70px/1.5em 'Microsoft YaHei';color:#aaa"></div>
<div class="dv-active2" style="padding:0px;text-align:right;font:30px/1.5em 'Microsoft YaHei';color:#aaa"></div>
</section>
<br>
<section class="sect-keep" style="float:left;margin:10px 0px 0px 5%;width:30%;height:150px;padding:20px;border:1px solid #fff; color:#000; border-radius:6px;background:white;box-shadow:0 0 8px #222; font:11px/1.5em 'Microsoft YaHei';">
<div class='alert alert-info alert-st' >日留存</div>
<div class="dv-keep-d" style="padding:0px;text-align:center;font:70px/1.5em 'Microsoft YaHei';color:#aaa"></div>
</section>
<section class="sect-keep" style="float:left;margin:10px 0px 0px 6px;width:30%;height:150px;padding:20px;border:1px solid #fff; color:#000; border-radius:6px;background:white;box-shadow:0 0 8px #222; font:11px/1.5em 'Microsoft YaHei';">
<div class='alert alert-info alert-st' >周留存</div>
<div class="dv-keep-w" style="padding:0px;text-align:center;font:70px/1.5em 'Microsoft YaHei';color:#aaa"></div>
</section>
<section class="sect-keep" style="float:left;margin:10px 0px 0px 6px;width:30%;height:150px;padding:20px;border:1px solid #fff; color:#000; border-radius:6px;background:white;box-shadow:0 0 8px #222; font:11px/1.5em 'Microsoft YaHei';">
<div class='alert alert-info alert-st' >月留存</div>
<div class="dv-keep-m" style="padding:0px;text-align:center;font:70px/1.5em 'Microsoft YaHei';color:#aaa"></div>
</section>
<br>
<section class="sect-pv" style="margin-left:5%;float:left;margin-top:10px;width:30%;height:210px;padding:20px;border:1px solid #fff; color:#000; border-radius:6px;background:white;box-shadow:0 0 8px #222; font:11px/1.5em 'Microsoft YaHei';">
<div id="filelist" class='alert alert-info alert-st' >PV</div>
<div class="dv-pv" style="padding:5px;text-align:center;font:50px/1.5em 'Microsoft YaHei';color:#aaa"></div>
</section>
<section class="sect-uv" style="float:left;margin:10px 0px 0px 6px;width:30%;height:210px;padding:20px;border:1px solid #fff; color:#000; border-radius:6px;background:white;box-shadow:0 0 8px #222; font:11px/1.5em 'Microsoft YaHei';">
<div id="filelist" class='alert alert-info alert-st' >UV</div>
<div class="dv-uv" style="padding:5px;text-align:center;font:50px/1.5em 'Microsoft YaHei';color:#aaa"></div>
</section>
<section class="sect-locate" style="float:left;margin:10px 0px 0px 6px;width:30%;height:210px;padding:20px;border:1px solid #fff; color:#000; border-radius:6px;background:white;box-shadow:0 0 8px #222; font:11px/1.5em 'Microsoft YaHei';">
<div id="filelist" class='alert alert-info alert-st' >locate</div>
<div class="panel panel-default font1">
<div class="panel-body">
<ul class="ul-loc">
</ul>
</div></div>
</section>
<br>
<!--section class="sect-chart" style="float:left;margin-top:10px;width:70%;height:400px;padding:10px;border:1px solid #fff; color:#000; border-radius:6px;background:white;box-shadow:0 0 8px #222; font:11px/1.5em 'Microsoft YaHei';">
<div id="filelist" class='alert alert-info alert-st' >&nbsp;</div>
<div id="highchart" style="width:600px;height:300px;"></div>
</section-->

<div class="dv-ext" style='z-index:1;left:0px;top:0px;position:absolute;background-color:#666;width:100%;height:100%;filter:alpha(opacity=90);opacity:0.9;display:none;'></div>
<div class='dv-ext-in' style="z-index:10;left:0px;top:0px;position:absolute;background-color:#fff;width:99%;height:90%;top:5%; border-radius:8px;display:none;">
<div class="tab" style="padding:50px;text-align:center;width:90%;"></div>
<div style="z-index:12;left:96%;position:absolute;top:3%;float:right;font:80px;cursor:pointer">
<span class="glyphicon glyphicon-remove tab-close" aria-hidden="true" style="color:#000;"></span></div>
<div id="chart" style="margin:-40px 0px 0px 50px;width:70%;height:300px;display:none;"></div>
</div>


<input type=hidden class='hid-pr'/>
</div>

<script type="text/javascript">
	var dt = new Date();
	var m="0"+(dt.getMonth()+1);
	var d="0"+(dt.getDate());
	vdt=dt.getFullYear()+"-"+m.substr(m.length-2,2)+"-"+d.substr(d.length-2,2);
	$('#ip-d-start').val(vdt)
	$('#iph-d-start').val(vdt)

	$('.form_date').datetimepicker({
        language: 'en',
        weekStart: 1,
        todayBtn:  1,
		autoclose: 1,
		todayHighlight: 1,
		startView: 2,
		minView: 2,
		forceParse: 0
    });
	$('.form_date').datetimepicker('setEndDate',vdt);

</script>
</body>
</html>