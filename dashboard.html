<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>DashBoard</title>
<link rel="stylesheet" href="include/css/bootstrap.css">
<link rel="stylesheet" href="include/css/bootstrap-datetimepicker.css">
<style>
body {margin:20px;background-color:#eee}
.dv-img {margin-top:25%;float:right;width:25px;height:70px;background:url('include/img/icon.jpg') no-repeat -138px -145px;cursor:pointer;}
.alert-st {padding:5px;text-align:center;font:18px/1.5em 'Microsoft YaHei';}
</style>
<script src="include/js/jquery-3.0.0.min.js"></script>
<script src="include/js/bootstrap.min.js"></script>
<script src="include/js/bootstrap-datetimepicker.js"></script>
<script src="include/js/highcharts.js"></script>
<script type="text/javascript">
function createXMLHttpRequest(url,dv){
	xmlhttp=""
	if(window.ActiveXObject){
		try{
		xmlhttp = new ActiveXObject("Msxml2.XMLHTTP");
		}catch(e){
		xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
		}}
		else if(window.XMLHttpRequest){
			xmlhttp = new XMLHttpRequest();
				if (xmlhttp.overrideMimeType){ xmlhttp.overrideMimeType("text/xml");}
		}
		if(!xmlhttp){ window.alert("Do not support XMLHttpRequest!");}
		xmlhttp.onreadystatechange=XHRChanged;
		xmlhttp.open("POST", url,false);
		xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");
		xmlhttp.send(dv);
}
function XHRChanged(){	//handle return value xmlhttp.responseText
	if (xmlhttp.readyState==4){
		getBack(xmlhttp.responseText);}
}

function showChart_columnStacked(cData,cTitle,content,xRay){
	var chart;
	var options = {
			chart: {
				renderTo: content,
				defaultSeriesType: 'column'
			},
			title: {
				text: cTitle
			},
			xAxis: {
				categories: xRay
			},
			yAxis: {
				min: 0,
				title: {
					text: ''
				}
			},
			legend: {
				align: 'right',
				x: -100,
				verticalAlign: 'top',
				y: 20,
				floating: true,
				backgroundColor: '#FFFFFF',
				borderColor: '#CCC',
				borderWidth: 1,
				shadow: false
			},
			tooltip: {
				formatter: function() {
					return '<b>'+ this.x +'</b> '+ this.series.name +': '+ this.y +' Total: '+ this.point.stackTotal;
				}
			},
			plotOptions: {
				column: {
					stacking: 'normal'
				}
			},
			series: []
		};
		var v,arr=new Array(),a=new Array();
		for (var i=0;i<cData.split(';').length;i++){
			arr=cData.split(';')[i].split(',');
			v=arr[0];
			arr.shift();
			for(var j=0;j<arr.length;j++){
				a[j]=parseInt(arr[j]);
			}
			options.series.push({name:v,data:a});
			a=[]
		}
		chart = new Highcharts.Chart(options);
}
function showChart_lineBasic(cData,cTitle,content,xRay){
	var chart;
	var options = {
			chart: {
				renderTo: content,
				defaultSeriesType: 'line',
				marginRight: 110,
				marginBottom: 25
			},
			title: {
				text: cTitle,
				x: -20 
			},
			subtitle: {
				text: '',
				x: -20
			},
			xAxis: {
				categories: xRay
			},
			yAxis: {
				title: {
					text: ''
				},
			plotLines: [{
				value: 0,
				width: 1,
				color: '#808080'
			}]
			},
			tooltip: {
				formatter: function() {
						return '<b>'+ this.series.name +'</b>'+
						this.x +': '+ this.y +'';
				}},
			legend: {
				layout: 'vertical',
				align: 'right',
				verticalAlign: 'top',
				x: -10,
				y: 100,
				borderWidth: 0
			},
			series:[]
		};
		var v,arr=new Array(),a=new Array();
		for (var i=0;i<cData.split(';').length;i++){
			arr=cData.split(';')[i].split(',');
			v=arr[0];
			arr.shift();
			for(var j=0;j<arr.length;j++){
				a[j]=parseInt(arr[j]);
			}
			options.series.push({name:v,data:a});
			a=[]
		}
		chart = new Highcharts.Chart(options);
}

function showChart_pieBasic(cData,cTitle,content){
	var chart;
	var options = {
		chart:{renderTo: content,
				plotBackgroundColor: null,
				plotBorderWidth: null,
				plotShadow: false
				},
		title:{text: cTitle},	// title
		subtitle:{text:'pieBasic'},
		tooltip:{formatter:function(){
					return '<b>'+ this.point.name +'</b>: '+ this.y +' %';
				}},
		plotOptions:{pie:{allowPointSelect:true,
							cursor:'pointer',
							dataLabels:{
							enabled:true,
							color:'#000000',
							connectorColor:'#000000',
							formatter:function(){
								return '<b>'+ this.point.name +'</b>: '+ this.y +' %';
							}}
						}
					},
		series:[{type: 'pie',
				name: 'Browser share',
				data:[]
				}]
		};
		var v,arr=new Array(),a=new Array(),b=new Array();
		a=cData.split(';')
		for (var j=0;j<a.length;j++){
			b[0]=a[j].split(',')[0];
			b[1]=parseFloat(a[j].split(',')[1]);
			arr[j]=b;
			b=[]
		}
		options.series[0].data = arr;
		chart = new Highcharts.Chart(options);
}

function getBack(vchReturn){
	try{
//	1##dashboard##0##2459##8885##06/01,06/02,06/03,06/04,06/05,06/06,06/07,06/08,06/09,06/10,06/11,06/12,06/13##Daily Active,794,1175,576,547,595,1052,1313,1569,1446,2210,1570,1727,825
	var vf=vchReturn.split("##")[1]
	if (vf=="getDashBoard"){
	var dtArr = new Array
	dtArr=vchReturn.split("##")[5].split(",");
	var dailyActData=vchReturn.split("##")[6];
	showChart_lineBasic(dailyActData,"","highchart",dtArr);
	$(".sect-chart .alert").html(vchReturn.split("##")[7]+" Active Customer")

	$(".sect-today .alert").html("Register at Today")
	$(".customer-today").html(vchReturn.split("##")[2])
	$(".sect-week .alert").html("Register in Last Week")
	var c="";
	if (vchReturn.split("##")[3]>=vchReturn.split("##")[4]){
		c='<span class="glyphicon glyphicon-arrow-up" aria-hidden="true" style="color:#6f0"></span>'
	}else{
		c='<span class="glyphicon glyphicon-arrow-down" aria-hidden="true" style="color:#f60"></span>'
	}
	$(".customer-week").html(c+"&nbsp;"+vchReturn.split("##")[3])
	}else
		$(".customer-today").html(vchReturn.split("##")[2])
		}catch(e){ alert(e);}
}
$(document).ready(function(){
	var user=document.cookie;
	user="cz"
	if (user==""){
		alert("Pls Login");
		window.location="index.html";
	}
	setTimeout(function(){
	url="dashboardGet.php?pid="+escape(document.cookie.split('#')[0])+"&obj="+escape("getDashBoard");
	createXMLHttpRequest(url,"fresh=" +Math.random());
	},600);
	$(".dv-img").click(function(){
		location.href="queryRp.html";
	})
	setInterval(function(){
	url="dashboardGet.php?pid="+escape(document.cookie.split('#')[0])+"&obj="+escape("getCustomer");
	createXMLHttpRequest(url,"fresh=" +Math.random());
	},8000);
	/*

	chdv="Firefox,45.0;IE,26.8;Opera,6.2;Others,0.7;Chrome,12.8##Source"
	var arr =new Array
	arr=chdv.split("##");
	cData=arr[0];
	cTitle=arr[1];
	content="dvSource";
	showChart_pieBasic(cData,cTitle,content);
	*/
})

</script>
</head>
<body><div class="dv-img"></div>
<div id="container">
<section class="sect-today" style="float:left;width:30%;height:250px;padding:20px;border:1px solid #fff; color:#000; border-radius:6px;background:white;box-shadow:0 0 8px #222; font:11px/1.5em 'Microsoft YaHei';">
<div id="filelist" class='alert alert-info alert-st' >&nbsp;</div>
<div class="customer-today" style="padding:5px;text-align:center;font:80px/1.5em 'Microsoft YaHei';color:#aaa"></div>
</section>

<section class="" style="float:left;margin-left:6px;width:35%;height:250px;padding:20px;border:1px solid #fff; color:#000; border-radius:6px;background:white;box-shadow:0 0 8px #222; font:11px/1.5em 'Microsoft YaHei';">
<div id="filelist" class='alert alert-info alert-st' >&nbsp;</div>

</section>

<section class="sect-week" style="float:left;margin-left:6px;width:30%;height:250px;padding:20px;border:1px solid #fff; color:#000; border-radius:6px;background:white;box-shadow:0 0 8px #222; font:11px/1.5em 'Microsoft YaHei';">
<div id="filelist" class='alert alert-info alert-st' >&nbsp;</div>
<div class="customer-week" style="padding:5px;text-align:center;font:50px/1.5em 'Microsoft YaHei';color:#aaa"></div>
</section>
<br>
<section class="sect-chart" style="float:left;margin-top:10px;width:70%;height:400px;padding:10px;border:1px solid #fff; color:#000; border-radius:6px;background:white;box-shadow:0 0 8px #222; font:11px/1.5em 'Microsoft YaHei';">
<div id="filelist" class='alert alert-info alert-st' >&nbsp;</div>
<div id="highchart" style="width:600px;height:300px;"></div>
</section>


<input type=hidden class='hid-pr'/>
</div>

<script type="text/javascript">
	var dt = new Date();
	var m="0"+(dt.getMonth()+1);
	var d="0"+(dt.getDate());
	vdt=dt.getFullYear()+"-"+m.substr(m.length-2,2)+"-"+d.substr(d.length-2,2);
	$('#ip-d-start').val(vdt)
	$('#iph-d-start').val(vdt)

	$('.form_date').datetimepicker({
        language: 'en',
        weekStart: 1,
        todayBtn:  1,
		autoclose: 1,
		todayHighlight: 1,
		startView: 2,
		minView: 2,
		forceParse: 0
    });
	$('.form_date').datetimepicker('setEndDate',vdt);

</script>
</body>
</html>